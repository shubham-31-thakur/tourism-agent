<!-- removed old commented template -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Indian Tourism Agent</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#f6fbff;
            --overlay-opacity:0.45;
            --card:#ffffff;
            --muted:#6b7280;
            --accent:#0ea5a4; /* teal */
            --accent-2:#0f172a; /* dark */
            --glass: rgba(255,255,255,0.6);
            --shadow: 0 6px 18px rgba(12,34,56,0.08);
            --radius:12px;
            font-synthesis: none;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0; font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            /* Use the project's static image as a background (rendered by Jinja) */
            --bg-image: url('{{ url_for("static", path="img1.png") }}');
            background:
                linear-gradient(rgba(240,247,255,var(--overlay-opacity)), rgba(246,251,255,var(--overlay-opacity))),
                var(--bg-image);
            background-size: cover, cover;
            background-position: center center, center center;
            background-repeat: no-repeat, no-repeat;
            background-attachment: fixed;
            color:var(--accent-2);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            padding:28px;
        }
        .wrap{max-width:980px;margin:0 auto}
        header{display:flex;align-items:center;justify-content:space-between;gap:16px}
        .brand{display:flex;align-items:center;gap:12px}
        .logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,#06b6d4,#7c3aed);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:var(--shadow)}
        h1{margin:0;font-size:1.25rem}
        p.lead{margin:6px 0 0;color:var(--muted);font-size:0.95rem}

        main{margin-top:18px;display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}
        @media (max-width:880px){main{grid-template-columns:1fr}}

    .card{background:rgba(255,255,255,0.96);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;backdrop-filter: blur(6px);border:1px solid rgba(15,23,42,0.06)}

        form .field{display:flex;flex-direction:column;margin-bottom:12px}
        label{font-size:0.9rem;margin-bottom:6px;color:var(--accent-2);font-weight:600}
        textarea, input[type="text"]{width:100%;padding:12px;border-radius:10px;border:1px solid #e6eef7;background:transparent;font-size:0.95rem;resize:vertical}
        textarea{min-height:120px}
        .controls{display:flex;gap:10px;align-items:center}

        button.primary{background:var(--accent);color:white;border:none;padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:0 6px 14px rgba(14,165,164,0.18)}
        button.ghost{background:transparent;border:1px solid #e6eef7;padding:9px 12px;border-radius:10px;cursor:pointer;color:var(--accent-2)}
        button:disabled{opacity:0.6;cursor:not-allowed}

        .response-area{white-space:pre-wrap;background:linear-gradient(180deg,#fbfeff,#ffffff);padding:16px;border-radius:10px;border:1px solid #eef6fb}
        .response-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .muted{color:var(--muted);font-size:0.9rem}
    h1,h2,h3{color:var(--accent-2)}
    /* Slight text lift for better contrast on busy backgrounds */
    h1,h2{ text-shadow: 0 1px 0 rgba(255,255,255,0.6) }

        .spinner{width:18px;height:18px;border-radius:50%;border:3px solid rgba(0,0,0,0.08);border-top-color:var(--accent);animation:spin 1s linear infinite;display:inline-block}
        @keyframes spin{to{transform:rotate(360deg)}}

        footer{margin-top:20px;text-align:center;color:var(--muted);font-size:0.85rem}
    /* Welcome modal */
    .modal-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(6,22,34,0.6);z-index:1000;opacity:0;pointer-events:none;transition:opacity .18s ease}
    .modal-overlay.show{opacity:1;pointer-events:auto}
    .modal{background:var(--card);padding:18px;border-radius:12px;max-width:620px;width:92%;box-shadow:var(--shadow);text-align:left;transform:translateY(12px);opacity:0;transition:transform .22s ease,opacity .22s ease}
    .modal-overlay.show .modal{transform:translateY(0);opacity:1}
    .modal h2{margin:0 0 6px;font-size:1.1rem}
    .modal p{margin:0 0 12px;color:var(--muted)}
    .modal .actions{display:flex;gap:8px;align-items:center}
    .modal .small{font-size:0.88rem;color:var(--muted);display:flex;align-items:center;gap:8px}
    .modal input[type="checkbox"]{width:16px;height:16px}
    /* Toast */
    .toast{position:fixed;right:18px;bottom:18px;background:var(--accent);color:white;padding:10px 14px;border-radius:10px;box-shadow:var(--shadow);opacity:0;transform:translateY(12px);transition:opacity .22s,transform .22s;z-index:1200}
    .toast.show{opacity:1;transform:translateY(0)}

    /* History */
    .history{margin-top:12px;border-top:1px dashed #eef6fb;padding-top:12px}
    .history h4{margin:0 0 8px;font-size:0.95rem}
    .chip{display:inline-block;background:#f1fbfa;border:1px solid #e6f6f6;color:var(--accent-2);padding:6px 10px;border-radius:999px;margin:4px 6px;cursor:pointer;font-size:0.9rem}
    .chip:focus{outline:2px solid #c7fbf8}
    /* Hero */
    .hero{display:flex;align-items:center;gap:18px;padding:20px;border-radius:12px;margin-bottom:18px;background:linear-gradient(90deg,rgba(6,182,212,0.06),rgba(124,58,237,0.04));border:1px solid rgba(14,165,164,0.04)}
    .hero .hero-text{flex:1}
    .hero h2{margin:0;font-size:1.25rem}
    .hero p{margin:6px 0 0;color:var(--muted)}
    .hero .hero-cta{display:flex;gap:8px;margin-top:10px}

    /* Response expanded */
    aside.card.expanded{position:fixed;inset:18px;z-index:1100;background:var(--card);box-shadow:0 30px 80px rgba(12,34,56,0.18);border-radius:12px;padding:22px;overflow:auto}
    .response-controls{display:flex;gap:8px;align-items:center}
    .skeleton{height:120px;background:linear-gradient(90deg,#eef7fb,#fbfeff);border-radius:8px;box-shadow:inset 0 0 0 1px #eef8fb;animation:pulse 1.2s infinite}
    @keyframes pulse{0%{opacity:0.85}50%{opacity:0.6}100%{opacity:0.85}}

    footer{
        margin-top:20px;text-align:center;color:var(--muted);font-size:0.85rem;
        color: #000;
    }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div class="brand">
                <div class="logo">TI</div>
                <div>
                    <h1>Indian Tourism Agent</h1>
                    <p class="lead">Ask about cities, attractions, best times to visit and travel tips.</p>
                </div>
            </div>
            <div class="actions" style="align-items:center;display:flex;gap:10px">
                <div class="muted">Built for friendly travel guidance</div>
                <button class="ghost" id="showWelcomeBtn" title="Show welcome message">Welcome</button>
                <button class="ghost" id="overlayToggle" title="Toggle overlay" aria-pressed="false">Overlay: Light</button>
            </div>
        </header>

        <div class="hero">
            <div class="hero-text">
                <h2>Plan your next Indian getaway â€” faster</h2>
                <p class="muted">Get quick travel tips, best seasons, and family-friendly itineraries tailored to cities across India.</p>
                <div class="hero-cta">
                    <button class="primary" id="ctaTry">Try sample question</button>
                    <button class="ghost" id="ctaWelcome">Welcome info</button>
                </div>
            </div>
            <div class="hero-art" aria-hidden="true">
                <!-- small illustrative SVG -->
                <svg width="160" height="100" viewBox="0 0 160 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="160" height="100" rx="12" fill="url(#g)" />
                    <defs>
                        <linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#06b6d4" stop-opacity="0.9"/><stop offset="1" stop-color="#7c3aed" stop-opacity="0.9"/></linearGradient>
                    </defs>
                </svg>
            </div>
        </div>

        <main>
            <section class="card">
                <form method="post" id="agentForm">
                    <div class="field">
                        <label for="agent_prompt">Agent instructions (optional)</label>
                        <textarea id="agent_prompt" name="agent_prompt" placeholder="Enter agent instructions here..." rows="5">{{ agent_prompt or '' }}</textarea>
                        <small class="muted">Use this to guide the assistant's tone or behavior (e.g. "focus on family-friendly activities").</small>
                    </div>

                    <div class="field">
                        <label for="user_query">Your question</label>
                        <input id="user_query" name="user_query" type="text" placeholder="Ask about any Indian city, landmark or travel need..." required>
                    </div>

                    <div class="controls">
                        <button type="submit" class="primary" id="submitBtn">
                            <span id="btnText">Ask</span>
                            <span id="btnSpinner" style="display:none;margin-left:8px" aria-hidden="true" class="spinner"></span>
                        </button>
                        <button type="button" class="ghost" id="sampleBtn">Try sample</button>
                    </div>
                    <div class="history" id="history">
                        <h4>Recent questions</h4>
                        <div id="historyList" aria-live="polite"></div>
                    </div>
                </form>
            </section>

            <aside class="card">
                <h3 style="margin-top:0">Response</h3>
                <div class="response-controls" style="margin-bottom:10px">
                    <button class="ghost" id="expandBtn">Expand</button>
                    <button class="ghost" id="downloadBtn">Download</button>
                </div>
                {% if response %}
                <div class="response-area" id="responseArea">
                    <div class="response-meta">
                        <div class="muted">Agent Response</div>
                        <div style="display:flex;gap:8px">
                            <button class="ghost" id="copyBtn">Copy</button>
                        </div>
                    </div>
                    <div id="responseText">{{ response }}</div>
                </div>
                {% else %}
                <div class="muted">No response yet. Ask a question to see results here.</div>
                {% endif %}
            </aside>
        </main>

        <footer>
            Tip: Try "Best time to visit Jaipur for a family trip" or add instructions to narrow results.
        </footer>
    </div>

    <!-- Welcome modal (active) -->
    <div class="modal-overlay" id="welcomeModal" role="dialog" aria-modal="true" aria-labelledby="welcomeTitle">
        <div class="modal" role="document">
            <h2 id="welcomeTitle">{{ welcome_title or 'Welcome to Indian Tourism Agent' }}</h2>
            <p>{{ welcome_message or 'Explore Indian cities, top attractions, travel tips and packing advice. This small tool helps you get quick, friendly travel guidance tailored to your needs.' }}</p>
            <p class="small">{{ welcome_small or 'What you can try: ask about best time to visit, family-friendly itineraries, local food tips, or packing lists for different regions.' }}</p>

            <div class="actions" style="margin-top:12px">
                <button class="primary" id="modalOk">{{ welcome_ok or "Let's go" }}</button>
                <button class="ghost" id="modalClose">{{ welcome_close or 'Close' }}</button>
                <label class="small" style="margin-left:auto"><input type="checkbox" id="dontShow"> {{ welcome_dont_show or "Don't show again" }}</label>
            </div>
        </div>
    </div>

    <script>
        // Overlay toggle: allows user to pick a stronger/darker overlay for readability
        (function(){
            try{
                const toggle = document.getElementById('overlayToggle');
                const LIGHT = 'light', DARK = 'dark';
                const values = { light: '0.45', dark: '0.7' };
                function apply(mode){
                    const v = values[mode] || values.light;
                    document.documentElement.style.setProperty('--overlay-opacity', v);
                    if(toggle){ toggle.textContent = 'Overlay: ' + (mode==='dark' ? 'Dark' : 'Light'); toggle.setAttribute('aria-pressed', mode==='dark'); }
                }
                const stored = localStorage.getItem('overlayMode') || LIGHT;
                apply(stored);
                if(toggle){ toggle.addEventListener('click', ()=>{ const next = (localStorage.getItem('overlayMode')||LIGHT) === LIGHT ? DARK : LIGHT; localStorage.setItem('overlayMode', next); apply(next); }); }
            }catch(e){console.warn('overlay toggle init failed', e)}
        })();
        // Enhance UX: show spinner on submit and provide a few sample prompts
        (function(){
            // Autofocus the query input for faster typing
            try{ const uq = document.getElementById('user_query'); if(uq){ uq.focus(); uq.setAttribute('autocomplete','off'); } }catch(e){}
            const form = document.getElementById('agentForm');
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            const sampleBtn = document.getElementById('sampleBtn');
            const copyBtn = document.getElementById('copyBtn');
            const responseText = document.getElementById('responseText');

            if(form){
                form.addEventListener('submit', function(){
                    submitBtn.disabled = true;
                    btnText.textContent = 'Thinking...';
                    btnSpinner.style.display = 'inline-block';
                    try{
                        // persist to session history
                        const q = document.getElementById('user_query');
                        if(q && q.value && window.sessionStorage){
                            const key = 'recentQueries';
                            let arr = JSON.parse(sessionStorage.getItem(key) || '[]');
                            arr = [q.value].concat(arr.filter(x=>x!==q.value)).slice(0,8);
                            sessionStorage.setItem(key, JSON.stringify(arr));
                            renderHistory();
                        }
                    }catch(e){/* ignore */}
                });
            }

            if(sampleBtn){
                sampleBtn.addEventListener('click', function(){
                    const q = document.getElementById('user_query');
                    const samples = [
                        'Top attractions in Varanasi for cultural travelers',
                        'Best time to visit Ladakh and what to pack',
                        'Family friendly activities in Goa for 3 days',
                        'Food and safety tips for Delhi street food'
                    ];
                    q.value = samples[Math.floor(Math.random()*samples.length)];
                    q.focus();
                });
            }

                // Keyboard shortcuts: Ctrl+K to focus query, Ctrl+Enter to submit
                document.addEventListener('keydown', function(e){
                    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='k'){
                        e.preventDefault(); const uq=document.getElementById('user_query'); if(uq) uq.focus();
                    }
                    if((e.ctrlKey || e.metaKey) && e.key==='Enter'){
                        const btn=document.getElementById('submitBtn'); if(btn) btn.click();
                    }
                });

                // expand/download response
                const expandBtn = document.getElementById('expandBtn');
                const downloadBtn = document.getElementById('downloadBtn');
                if(expandBtn){
                    expandBtn.addEventListener('click', function(){
                        const aside = document.querySelector('aside.card');
                        if(aside.classList.contains('expanded')){ aside.classList.remove('expanded'); expandBtn.textContent='Expand'; }
                        else{ aside.classList.add('expanded'); expandBtn.textContent='Close'; }
                    });
                }
                if(downloadBtn){
                    downloadBtn.addEventListener('click', function(){
                        try{
                            const text = document.getElementById('responseText')?.innerText || '';
                            const blob = new Blob([text], {type:'text/plain'});
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a'); a.href=url; a.download='response.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
                        }catch(e){console.warn('download failed',e)}
                    });
                }

                // Hero CTAs
                const ctaTry = document.getElementById('ctaTry');
                const ctaWelcome = document.getElementById('ctaWelcome');
                if(ctaTry) ctaTry.addEventListener('click', ()=> sampleBtn && sampleBtn.click());
                if(ctaWelcome) ctaWelcome.addEventListener('click', ()=>{ const wb=document.getElementById('showWelcomeBtn'); if(wb) wb.click(); });

            // render history from sessionStorage
            function renderHistory(){
                try{
                    const key = 'recentQueries';
                    const el = document.getElementById('historyList');
                    if(!el) return;
                    const arr = JSON.parse(sessionStorage.getItem(key) || '[]');
                    el.innerHTML = '';
                    arr.forEach(v=>{
                        const b = document.createElement('button');
                        b.className = 'chip';
                        b.textContent = v;
                        b.type = 'button';
                        b.addEventListener('click', ()=>{ document.getElementById('user_query').value = v; document.getElementById('user_query').focus(); });
                        el.appendChild(b);
                    });
                }catch(e){/* ignore */}
            }
            renderHistory();

            if(copyBtn && responseText){
                copyBtn.addEventListener('click', async function(){
                    try{
                        await navigator.clipboard.writeText(responseText.innerText || responseText.textContent);
                        copyBtn.textContent = 'Copied';
                        showToast('Copied to clipboard');
                        setTimeout(()=> copyBtn.textContent = 'Copy',1500);
                    }catch(e){
                        console.warn('copy failed',e);
                        copyBtn.textContent = 'Copy (select)';
                    }
                });
            }

            // Welcome modal logic
            try{
                const modal = document.getElementById('welcomeModal');
                const modalOk = document.getElementById('modalOk');
                const modalClose = document.getElementById('modalClose');
                const dontShow = document.getElementById('dontShow');
                const hideModal = ()=> modal && modal.classList.remove('show');
                const showModal = ()=> modal && modal.classList.add('show');

                // configurable via Jinja: welcome_delay and welcome_storage_key
                const storageKey = "{{ welcome_storage_key or 'dontShowWelcome' }}";
                const delay = parseInt("{{ welcome_delay or 400 }}", 10) || 400;

                const lsAvailable = (()=>{
                    try{ const k='__t'; localStorage.setItem(k,k); localStorage.removeItem(k); return true }catch(e){return false}
                })();
                const disabled = lsAvailable && localStorage.getItem(storageKey);
                if(modal && !disabled){
                    // show after a short delay to avoid visual jump
                    setTimeout(()=> showModal(), delay);
                }

                if(modalOk) modalOk.addEventListener('click', function(){
                    if(dontShow && dontShow.checked && lsAvailable) localStorage.setItem(storageKey,'1');
                    hideModal();
                });
                if(modalClose) modalClose.addEventListener('click', function(){
                    hideModal();
                });
                const showWelcomeBtn = document.getElementById('showWelcomeBtn');
                if(showWelcomeBtn){
                    showWelcomeBtn.addEventListener('click', function(){
                        // always show when manually requested
                        showModal();
                    });
                }
                // overlay click closes modal
                if(modal){
                    modal.addEventListener('click', function(e){ if(e.target===modal) hideModal(); });
                }
                // esc closes modal
                document.addEventListener('keydown', function(e){ if(e.key==='Escape') hideModal(); });
                // Toast element
                const toast = document.createElement('div'); toast.id='toastEl'; toast.className='toast'; toast.setAttribute('role','status'); document.body.appendChild(toast);
                function showToast(msg,timeout=1700){ try{ const t = document.getElementById('toastEl'); t.textContent = msg; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'), timeout); }catch(e){} }
            }catch(e){console.warn('modal init failed',e)}
        })();
    </script>
</body>
</html>
